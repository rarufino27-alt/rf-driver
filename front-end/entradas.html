<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Livro Caixa - RF Driver</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

<link rel="stylesheet" href="css/css-theme.css">
</head>

<body>

<div class="drawer-toggle" onclick="GlobalUI.toggleDrawer()">
  <i class="fa fa-bars"></i>
</div>

<div class="theme-toggle" onclick="GlobalTheme.toggle()">
  <i class="fa fa-moon"></i>
</div>

<div id="menu-lateral"></div>

<main id="conteudo">

  <section class="card">
    <h1 style="color:var(--gold)">Livro Caixa</h1>
    <p style="opacity:.7">Controle financeiro diÃ¡rio</p>
  </section>

  <section class="card resumo-caixa">
    <div><small>Entradas</small><strong id="resEntradas">R$ 0,00</strong></div>
    <div><small>SaÃ­das</small><strong id="resSaidas">R$ 0,00</strong></div>
    <div class="destaque"><small>Saldo</small><strong id="resSaldo">R$ 0,00</strong></div>
  </section>

  <section class="card">
    <button class="btn-primary" onclick="fecharCaixa()">
      ðŸ”’ Fechar Caixa do Dia
    </button>
  </section>

</main>

<div id="menu-inferior"></div>

<script src="js/js-dataManager.js"></script>
<script src="js/js-global.js"></script>
<script src="js/PlanoManager.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  GlobalUI.loadComponent("menu-lateral","components/components-menu-lateral.html");
  GlobalUI.loadComponent("menu-inferior","components/components-menu-inferior.html");
  atualizarResumo();
});

function atualizarResumo(){
  const entradas = Number(localStorage.getItem("rf_caixa_total_entradas") || 0);
  const saidas = Number(localStorage.getItem("rf_caixa_total_saidas") || 0);
  const saldo = entradas - saidas;

  resEntradas.innerText = entradas.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
  resSaidas.innerText = saidas.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
  resSaldo.innerText = saldo.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}

function fecharCaixa(){
  if(!confirm("Fechar o caixa e enviar o saldo para a carteira?")) return;

  const entradas = Number(localStorage.getItem("rf_caixa_total_entradas") || 0);
  const saidas = Number(localStorage.getItem("rf_caixa_total_saidas") || 0);
  const saldo = entradas - saidas;

  if(saldo <= 0){
    alert("Saldo zerado ou negativo.");
    return;
  }

  const resp = DataManager.adicionarSaldoCarteira(saldo);
  if(!resp.ok){
    alert(resp.msg || "Erro ao fechar caixa.");
    return;
  }

  localStorage.removeItem("rf_caixa");
  localStorage.removeItem("rf_caixa_total_entradas");
  localStorage.removeItem("rf_caixa_total_saidas");

  alert("Caixa fechado com sucesso.");
  location.reload();
}
</script>

</body>
</html>
