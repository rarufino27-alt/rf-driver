<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Livro Caixa ‚Äî RF Driver</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<link rel="stylesheet" href="css/css-theme.css">

  <style>
:root{
  --gold:#f5c542; --bg:#0d0d0d; --text:#f4f4f4;
  --card:#161616; --border:#242424;
  --green:#1DB954; --red:#ff3b30;
}
body[data-theme="light"]{
  --bg:#f4f4f4; --text:#111; --card:#fff; --border:#ddd;
}
*{box-sizing:border-box;font-family:Inter}
body{margin:0;background:var(--bg);color:var(--text);padding:70px 16px 150px}

/* HEADER */
.header{text-align:center;margin-bottom:10px}
.header h1{margin:0;font-size:26px;color:var(--gold)}
.header small{opacity:.7}

/* TOGGLES */
.drawer-toggle,.theme-toggle{
  position:fixed;top:15px;font-size:22px;color:var(--gold);
  cursor:pointer;z-index:20
}
.drawer-toggle{left:15px}
.theme-toggle{right:15px}

/* DRAWER */
.drawer{
  position:fixed;top:0;left:-260px;width:260px;height:100%;
  background:var(--card);border-right:1px solid var(--border);
  padding-top:20px;transition:.3s;z-index:15
}
.drawer.open{left:0}
.drawer a{
  display:flex;gap:12px;padding:14px 20px;
  color:var(--text);font-size:15px;
  text-decoration:none;border-bottom:1px solid var(--border)
}
.drawer .close-btn{
  text-align:right;padding:10px 20px;cursor:pointer
}

/* CARDS */
.card,.summary{
  background:var(--card);border:1px solid var(--border);
  border-radius:14px;padding:16px;margin-bottom:15px
}
.summary-row{display:flex;justify-content:space-between;font-weight:600}

/* TABS */
.tab-buttons{display:flex;gap:8px;margin-bottom:10px}
.tab-btn{
  flex:1;padding:12px;border-radius:12px;
  border:1px solid var(--border);
  background:var(--card);color:var(--text);
  opacity:.6;font-weight:600;cursor:pointer
}
.tab-btn.active{opacity:1;border-color:var(--gold);color:var(--gold)}

.tab{display:none}

/* INPUTS */
input,select{
  width:100%;padding:12px;margin-bottom:10px;
  border-radius:10px;border:1px solid var(--border);
  background:var(--bg);color:var(--text)
}

/* TABLE */
table{width:100%;border-collapse:collapse}
td{padding:10px;border-bottom:1px solid var(--border)}
.del{color:var(--red);cursor:pointer;font-weight:700}

/* FOOTER ACTION */
.footer-action{
  position:fixed;
  bottom:90px;
  left:16px;
  right:16px;
}

/* BOTTOM NAV */
.bottom-nav{
  position:fixed;bottom:0;left:0;right:0;
  background:var(--card);
  display:flex;justify-content:space-around;padding:8px 0
}
.bottom-nav a{color:var(--text);font-size:15px;text-decoration:none}
.center-btn{
  background:var(--gold);color:#000;width:58px;height:58px;
  border-radius:50%;display:flex;align-items:center;
  justify-content:center;font-size:24px;margin-top:-30px
}

.suporte-whatsapp{
  margin:16px;padding:10px 14px;background:#25d366;color:#fff;
  border-radius:999px;text-align:center;font-weight:600;
  text-decoration:none;display:flex;align-items:center;
  justify-content:center;gap:8px
}
</style>
</head>

<body>

<!-- TOGGLES -->
<div class="drawer-toggle" onclick="GlobalUI.toggleDrawer()">
  <i class="fa fa-bars"></i>
</div>

<div class="theme-toggle" onclick="GlobalTheme.toggle()">
  <i class="fa fa-moon"></i>
</div>

<!-- MENU LATERAL -->
<div id="menu-lateral"></div>

<!-- CONTE√öDO -->
<main id="conteudo">

  <!-- HEADER -->
  <section class="card hero-card">
    <h1 class="hero-title">Livro Caixa</h1>
    <p class="hero-subtitle">Controle financeiro di√°rio</p>
  </section>

  <!-- RESUMO -->
  <section class="card">
    <div class="dashboard-grid">
      <div class="card entrada">
        <small>Entradas</small>
        <strong id="resEntradas">R$ 0,00</strong>
      </div>

      <div class="card saida">
        <small>Sa√≠das</small>
        <strong id="resSaidas">R$ 0,00</strong>
      </div>
    </div>

    <div style="margin-top:14px;text-align:center">
      <small style="opacity:.7">Saldo do caixa</small>
      <strong id="resSaldo"
              style="display:block;font-size:1.6rem;color:var(--gold)">
        R$ 0,00
      </strong>
    </div>

    <canvas id="grafico" height="120" style="margin-top:16px"></canvas>
  </section>

  <!-- FECHAR CAIXA -->
  <section class="card">
    <button class="btn-primary"
            style="background:#1DB954"
            onclick="fecharCaixa()">
      üîí Fechar Caixa do Dia
    </button>
  </section>

  <!-- TABS -->
  <section class="tab-buttons">
    <button class="tab-btn active" data-tab="corridas">Corridas</button>
    <button class="tab-btn" data-tab="outras">Outras Entradas</button>
    <button class="tab-btn" data-tab="saidas">Sa√≠das</button>
  </section>

  <!-- CORRIDAS -->
  <section class="card tab" id="corridas">
    <select id="tipoCorrida">
      <option value="">Tipo de corrida</option>
      <option value="App">Aplicativos</option>
      <option value="Entrega">Entregas</option>
      <option value="Empresa">Empresa</option>
      <option value="Particular">Particular</option>
    </select>

    <select id="subTipo" style="display:none"></select>

    <input id="valorCorrida" type="number" placeholder="Valor (R$)">

    <table>
      <tbody id="listaCorridas"></tbody>
    </table>
  </section>

  <!-- OUTRAS -->
  <section class="card tab" id="outras" style="display:none">
    <input id="descOutra" placeholder="Descri√ß√£o">
    <input id="valorOutra" type="number" placeholder="Valor (R$)">

    <table>
      <tbody id="listaOutras"></tbody>
    </table>
  </section>

  <!-- SA√çDAS -->
  <section class="card tab" id="saidas" style="display:none">
    <select id="tipoSaida">
      <option>Combust√≠vel</option>
      <option>Alimenta√ß√£o</option>
      <option>Ped√°gio</option>
      <option>Outros</option>
    </select>

    <input id="valorSaida" type="number" placeholder="Valor (R$)">

    <table>
      <tbody id="listaSaidas"></tbody>
    </table>
  </section>

  <!-- REGISTRAR -->
  <section class="cta-area">
    <button class="btn-primary" onclick="registrar()">
      Registrar lan√ßamento
    </button>
  </section>

</main>

<!-- MENU INFERIOR -->
<div id="menu-inferior"></div>

<!-- SCRIPTS -->
<script src="js/js-global.js"></script>
<script src="js/js-dataManager.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {

  GlobalUI.loadComponent(
    "menu-lateral",
    "components/components-menu-lateral.html"
  );

  GlobalUI.loadComponent(
    "menu-inferior",
    "components/components-menu-inferior.html"
  );

  let dados = JSON.parse(localStorage.getItem("rf_caixa")) || {
    entradas: [],
    saidas: []
  };

  const grafico = new Chart(
    document.getElementById("grafico"),{
      type:"bar",
      data:{
        labels:["Entradas","Sa√≠das"],
        datasets:[{
          data:[0,0],
          backgroundColor:["#1DB954","#ff3b30"]
        }]
      },
      options:{
        plugins:{legend:{display:false}},
        scales:{y:{beginAtZero:true}}
      }
    }
  );

  function atualizar(){
    const ent = dados.entradas.reduce((s,i)=>s + Number(i.valor||0),0);
    const sai = dados.saidas.reduce((s,i)=>s + Number(i.valor||0),0);

    resEntradas.innerText = ent.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
    resSaidas.innerText   = sai.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
    resSaldo.innerText    = (ent - sai).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

    grafico.data.datasets[0].data = [ent,sai];
    grafico.update();

    localStorage.setItem("rf_caixa",JSON.stringify(dados));
    localStorage.setItem("rf_caixa_total_entradas",ent);
    localStorage.setItem("rf_caixa_total_saidas",sai);
  }

  function render(){
    listaCorridas.innerHTML = dados.entradas.map((e,i)=>`
      <tr>
        <td>${e.desc}</td>
        <td>${e.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</td>
        <td class="del" onclick="del('entradas',${i})">‚úï</td>
      </tr>
    `).join("");

    listaSaidas.innerHTML = dados.saidas.map((e,i)=>`
      <tr>
        <td>${e.desc}</td>
        <td>${e.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</td>
        <td class="del" onclick="del('saidas',${i})">‚úï</td>
      </tr>
    `).join("");
  }

  window.registrar = function(){
    if(corridas.style.display !== "none"){
      if(!valorCorrida.value) return;
      dados.entradas.push({
        desc: tipoCorrida.value + (subTipo.value ? " - "+subTipo.value : ""),
        valor: Number(valorCorrida.value)
      });
      valorCorrida.value="";
    }

    if(outras.style.display !== "none"){
      if(!valorOutra.value) return;
      dados.entradas.push({
        desc: descOutra.value,
        valor: Number(valorOutra.value)
      });
      descOutra.value = valorOutra.value = "";
    }

    if(saidas.style.display !== "none"){
      if(!valorSaida.value) return;
      dados.saidas.push({
        desc: tipoSaida.value,
        valor: Number(valorSaida.value)
      });
      valorSaida.value="";
    }

    render();
    atualizar();
  }

  window.del = function(tipo,i){
    dados[tipo].splice(i,1);
    render();
    atualizar();
  }

  window.fecharCaixa = function(){
    const ent = dados.entradas.reduce((s,i)=>s + Number(i.valor||0),0);
    const sai = dados.saidas.reduce((s,i)=>s + Number(i.valor||0),0);
    const saldo = ent - sai;

    if(saldo <= 0) return alert("Saldo zerado ou negativo.");

    if(!confirm(`Fechar caixa e enviar ${saldo.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})} para a carteira?`)) return;

    const resp = DataManager.adicionarSaldoCarteira(saldo);
    if(!resp.ok) return alert(resp.msg || "Erro ao fechar caixa.");

    localStorage.removeItem("rf_caixa");
    localStorage.removeItem("rf_caixa_total_entradas");
    localStorage.removeItem("rf_caixa_total_saidas");

    location.reload();
  }

  document.querySelectorAll(".tab-btn").forEach(btn=>{
    btn.onclick = ()=>{
      document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      document.querySelectorAll(".tab").forEach(t=>t.style.display="none");
      document.getElementById(btn.dataset.tab).style.display="block";
    }
  });

  atualizar();
  render();
});
</script>

</body>
</html>

